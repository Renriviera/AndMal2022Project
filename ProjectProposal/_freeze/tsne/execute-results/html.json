{
  "hash": "d9f2708a939495788f44aa7c92a370a9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"t-SNE Visualization\"\nformat: html\n---\n\nt-SNE (t-distributed Stochastic Neighbor Embedding) provides a powerful way to visualize high-dimensional malware data in 2D and 3D space. This visualization reveals how samples cluster by category and helps identify patterns in the feature space that may not be apparent in higher dimensions.\n\n> **Note**: t-SNE computations are disabled by default (`eval: false`) to speed up rendering. \n> To regenerate t-SNE plots, set `eval: true` in the code chunks below. \n> Computation takes 10-30 minutes for 2D and 15-45 minutes for 3D embeddings.\n> Cached results will be used if available.\n\n### 2D t-SNE Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Rtsne)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(viridis)\nlibrary(stringr)\n\n# Load preprocessed data\nandmal_after <- readRDS(\"data/processed/andmal_after.rds\")\n\ncat(sprintf(\"Loaded dataset: %d rows, %d columns\\n\", nrow(andmal_after), ncol(andmal_after)))\n\n# Extract feature columns using same logic as category model\nmetadata_cols <- c(\"Category\", \"Family\", \"Category_file\", \"reboot_state\", \"path\", \"file\", \"Hash\")\nall_cols <- names(andmal_after)\nmetadata_cols_present <- intersect(metadata_cols, all_cols)\n\n# Feature columns (exclude metadata and rank/color columns)\nfeature_cols <- setdiff(all_cols, metadata_cols_present)\nfeature_cols <- feature_cols[!str_detect(feature_cols, \"rank|color|fam_color|rank_in_cat\")]\n\ncat(sprintf(\"Using %d features for t-SNE\\n\", length(feature_cols)))\n\n# Extract feature matrix and category labels\nfeature_matrix <- andmal_after[, feature_cols, drop = FALSE]\ncategory_labels <- andmal_after$Category\n\n# Handle any missing values (replace with 0)\nfeature_matrix[is.na(feature_matrix)] <- 0\n\n# Remove constant/zero variance columns (required for PCA scaling)\nfeature_matrix <- as.matrix(feature_matrix)\nconstant_cols <- apply(feature_matrix, 2, function(x) var(x, na.rm = TRUE) == 0)\nif (sum(constant_cols) > 0) {\n  cat(sprintf(\"Removing %d constant/zero variance columns\\n\", sum(constant_cols)))\n  feature_matrix <- feature_matrix[, !constant_cols, drop = FALSE]\n}\n\ncat(\"Computing 2D t-SNE embedding...\\n\")\ncat(\"This may take 10-30 minutes depending on dataset size and hardware.\\n\")\n\n# Compute t-SNE (2D)\nset.seed(42)\ntsne_result_2d <- Rtsne(\n  feature_matrix,\n  dims = 2,\n  perplexity = 30,\n  max_iter = 1000,\n  theta = 0.5,\n  pca = TRUE,\n  pca_scale = TRUE,\n  verbose = TRUE,\n  check_duplicates = FALSE\n)\n\ncat(\"t-SNE computation complete.\\n\")\n\n# Create data frame for plotting\ntsne_df_2d <- data.frame(\n  tsne_1 = tsne_result_2d$Y[, 1],\n  tsne_2 = tsne_result_2d$Y[, 2],\n  Category = category_labels\n)\n\n# Create 2D plot\np_tsne_2d <- ggplot(tsne_df_2d, aes(x = tsne_1, y = tsne_2, color = Category)) +\n  geom_point(alpha = 0.6, size = 0.8) +\n  scale_color_viridis_d(option = \"H\", end = 0.9) +\n  labs(\n    title = \"t-SNE Visualization of Malware Samples\",\n    subtitle = \"2D embedding colored by malware category\",\n    x = \"t-SNE Component 1\",\n    y = \"t-SNE Component 2\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0),\n    plot.subtitle = element_text(hjust = 0),\n    legend.position = \"right\"\n  )\n\np_tsne_2d\n```\n:::\n\n\n### 3D Interactive t-SNE Visualization\n\nFor datasets of this size (~25,000 samples), a 3D interactive plot is feasible. Modern browsers can handle this number of points reasonably well, though rendering may be slower on older machines. The interactive plot allows for rotation and zooming, providing additional insights into the data structure.\n\n**Feasibility Assessment:**\n- **Dataset size**: ~25,000 points is manageable for 3D interactive visualization\n- **Rendering performance**: Should be acceptable with modern browsers\n- **File size**: Interactive HTML may be 5-15 MB\n- **Recommendation**: Yes, 3D plot is feasible and recommended for exploratory analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(plotly)\n\n# Compute t-SNE (3D)\ncat(\"Computing 3D t-SNE embedding...\\n\")\ncat(\"This may take 15-45 minutes depending on dataset size and hardware.\\n\")\n\nset.seed(42)\ntsne_result_3d <- Rtsne(\n  feature_matrix,\n  dims = 3,\n  perplexity = 30,\n  max_iter = 1000,\n  theta = 0.5,\n  pca = TRUE,\n  pca_scale = TRUE,\n  verbose = TRUE,\n  check_duplicates = FALSE\n)\n\ncat(\"3D t-SNE computation complete.\\n\")\n\n# Create data frame for 3D plotting\ntsne_df_3d <- data.frame(\n  tsne_1 = tsne_result_3d$Y[, 1],\n  tsne_2 = tsne_result_3d$Y[, 2],\n  tsne_3 = tsne_result_3d$Y[, 3],\n  Category = category_labels\n)\n\n# Create interactive 3D plot\np_tsne_3d <- plotly::plot_ly(\n  tsne_df_3d,\n  x = ~tsne_1,\n  y = ~tsne_2,\n  z = ~tsne_3,\n  color = ~Category,\n  colors = viridis::viridis_pal(option = \"H\", end = 0.9)(length(unique(tsne_df_3d$Category))),\n  type = \"scatter3d\",\n  mode = \"markers\",\n  marker = list(\n    size = 3,\n    opacity = 0.6\n  ),\n  text = ~paste(\"Category:\", Category),\n  hoverinfo = \"text\"\n) %>%\n  plotly::layout(\n    title = \"3D t-SNE Visualization of Malware Samples\",\n    scene = list(\n      xaxis = list(title = \"t-SNE Component 1\"),\n      yaxis = list(title = \"t-SNE Component 2\"),\n      zaxis = list(title = \"t-SNE Component 3\")\n    )\n  )\n\np_tsne_3d\n```\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}